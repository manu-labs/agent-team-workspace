import { useState } from 'react';
import { useGameStore } from '../stores/gameStore';
import { useAuthStore } from '../stores/authStore';
import { scoresApi } from '../services/api';
import { getGame } from './GameCanvas';

export default function GameOverlay() {
  const status = useGameStore((s) => s.status);
  const { score, level, linesCleared, durationSeconds } = useGameStore();
  const { isAuthenticated, token } = useAuthStore();
  const [submitting, setSubmitting] = useState(false);
  const [submitted, setSubmitted] = useState(false);
  const [submitResult, setSubmitResult] = useState(null);
  const [submitError, setSubmitError] = useState('');

  const game = getGame();

  function handleStart() {
    setSubmitted(false);
    setSubmitResult(null);
    setSubmitError('');
    game.startGame();
  }

  function handleResume() {
    game.resumeGame();
  }

  async function handleSubmitScore() {
    setSubmitting(true);
    setSubmitError('');
    try {
      const result = await scoresApi.submit(token, {
        score,
        lines_cleared: linesCleared,
        level,
        duration_seconds: durationSeconds,
      });
      setSubmitResult(result);
      setSubmitted(true);
    } catch (err) {
      setSubmitError(err.message || 'Failed to submit score');
    } finally {
      setSubmitting(false);
    }
  }

  // ── Idle: Start screen ──────────────────────────────────────────────────
  if (status === 'idle') {
    return (
      <div className="absolute inset-0 flex items-center justify-center z-20">
        <div className="text-center space-y-6">
          <h1 className="font-display text-5xl md:text-6xl font-black tracking-widest text-neon-cyan neon-text">
            SPACE TETRIS
          </h1>
          <p className="font-mono text-white/40 text-sm">
            Stack blocks. Clear lines. Reach for the stars.
          </p>
          <button onClick={handleStart} className="btn-primary text-lg">
            Start Game
          </button>
          <div className="font-mono text-xs text-white/20 space-y-0.5">
            <p>Arrow keys or WASD to move</p>
            <p>Space to hard drop</p>
          </div>
        </div>
      </div>
    );
  }

  // ── Paused ──────────────────────────────────────────────────────────────
  if (status === 'paused') {
    return (
      <div className="absolute inset-0 flex items-center justify-center z-20 bg-space-900/70 backdrop-blur-sm">
        <div className="glass-panel p-8 text-center space-y-4">
          <h2 className="font-display text-2xl font-bold tracking-wider text-neon-yellow neon-text">
            PAUSED
          </h2>
          <button onClick={handleResume} className="btn-primary">
            Resume
          </button>
          <p className="font-mono text-xs text-white/30">Press P or Esc to resume</p>
        </div>
      </div>
    );
  }

  // ── Game over ───────────────────────────────────────────────────────────
  if (status === 'gameover') {
    return (
      <div className="absolute inset-0 flex items-center justify-center z-20 bg-space-900/80 backdrop-blur-sm">
        <div className="glass-panel p-8 text-center space-y-4 max-w-sm">
          <h2 className="font-display text-3xl font-black tracking-wider text-neon-red neon-text">
            GAME OVER
          </h2>
          <div className="space-y-2 font-mono">
            <p className="text-neon-yellow text-2xl font-bold">{score.toLocaleString()}</p>
            <div className="flex justify-center gap-6 text-sm text-white/60">
              <span>Level {level}</span>
              <span>{linesCleared} lines</span>
            </div>
          </div>

          {/* Score submission */}
          {isAuthenticated && !submitted && (
            <div className="pt-2">
              {submitError && <p className="text-neon-red text-xs mb-2">{submitError}</p>}
              <button
                onClick={handleSubmitScore}
                disabled={submitting}
                className="btn-primary w-full"
              >
                {submitting ? 'Submitting...' : 'Submit Score'}
              </button>
            </div>
          )}

          {submitted && submitResult && (
            <div className="pt-2 space-y-1">
              <p className="text-neon-green font-mono text-sm">Score submitted!</p>
              {submitResult.rank && (
                <p className="text-white/60 font-mono text-xs">
                  Rank: #{submitResult.rank}
                </p>
              )}
            </div>
          )}

          {!isAuthenticated && (
            <p className="text-xs text-white/30 font-mono">
              Log in to submit your score to the leaderboard
            </p>
          )}

          <button onClick={handleStart} className="btn-secondary w-full">
            Play Again
          </button>
        </div>
      </div>
    );
  }

  return null; // Playing — no overlay
}

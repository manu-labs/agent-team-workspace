import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAuthStore } from '../stores/authStore';
import { scoresApi } from '../services/api';

/**
 * Overlays for start screen, pause, and game over.
 *
 * @param {{ status: string, game: object, score: number, level: number, lines: number, duration: number }}
 */
export default function GameOverlay({ status, game, score, level, lines, duration }) {
  if (status === 'idle') return <StartOverlay onStart={() => game.startGame()} />;
  if (status === 'paused') return <PauseOverlay onResume={() => game.resumeGame()} />;
  if (status === 'gameover') return (
    <GameOverScreen
      game={game}
      score={score}
      level={level}
      lines={lines}
      duration={duration}
    />
  );
  return null;
}

function StartOverlay({ onStart }) {
  return (
    <div className="absolute inset-0 flex items-center justify-center bg-space-900/80 backdrop-blur-sm z-10">
      <div className="text-center space-y-6">
        <h1 className="font-display text-5xl md:text-6xl font-black tracking-widest text-neon-cyan neon-text">
          SPACE TETRIS
        </h1>
        <p className="font-mono text-sm text-white/40">Stack blocks. Clear lines. Reach the stars.</p>
        <button onClick={onStart} className="btn-primary text-lg">
          Play
        </button>
        <div className="font-mono text-xs text-white/20 space-y-1">
          <p>Arrow keys to move {'|'} Up to rotate {'|'} Space to drop</p>
          <p>C to hold {'|'} P to pause {'|'} Shift for CCW rotate</p>
        </div>
      </div>
    </div>
  );
}

function PauseOverlay({ onResume }) {
  return (
    <div className="absolute inset-0 flex items-center justify-center bg-space-900/70 backdrop-blur-sm z-10">
      <div className="text-center space-y-4">
        <h2 className="font-display text-3xl font-bold tracking-wider text-neon-yellow neon-text animate-glow-pulse">
          PAUSED
        </h2>
        <button onClick={onResume} className="btn-primary">
          Resume
        </button>
        <p className="font-mono text-xs text-white/20">Press P to resume</p>
      </div>
    </div>
  );
}

function GameOverScreen({ game, score, level, lines, duration }) {
  const { isAuthenticated, token } = useAuthStore();
  const [submitted, setSubmitted] = useState(false);
  const [submitting, setSubmitting] = useState(false);
  const [error, setError] = useState('');
  const [rank, setRank] = useState(null);
  const navigate = useNavigate();

  const mins = Math.floor(duration / 60);
  const secs = duration % 60;

  const handleSubmit = async () => {
    setSubmitting(true);
    setError('');
    try {
      const result = await scoresApi.submit(token, {
        score,
        lines_cleared: lines,
        level,
        duration_seconds: duration,
      });
      setRank(result.rank);
      setSubmitted(true);
    } catch (err) {
      setError(err.message || 'Failed to submit score');
    } finally {
      setSubmitting(false);
    }
  };

  return (
    <div className="absolute inset-0 flex items-center justify-center bg-space-900/80 backdrop-blur-sm z-10">
      <div className="glass-panel p-8 max-w-sm w-full space-y-5 text-center">
        <h2 className="font-display text-3xl font-bold tracking-wider text-neon-red neon-text">
          GAME OVER
        </h2>

        <div className="grid grid-cols-2 gap-3 text-left">
          <div>
            <div className="text-[10px] font-display uppercase tracking-widest text-white/30">Score</div>
            <div className="text-2xl font-mono font-bold text-neon-yellow">{score.toLocaleString()}</div>
          </div>
          <div>
            <div className="text-[10px] font-display uppercase tracking-widest text-white/30">Level</div>
            <div className="text-2xl font-mono font-bold text-neon-cyan">{level}</div>
          </div>
          <div>
            <div className="text-[10px] font-display uppercase tracking-widest text-white/30">Lines</div>
            <div className="text-2xl font-mono font-bold text-neon-green">{lines}</div>
          </div>
          <div>
            <div className="text-[10px] font-display uppercase tracking-widest text-white/30">Time</div>
            <div className="text-2xl font-mono font-bold text-white/60">
              {mins}:{secs.toString().padStart(2, '0')}
            </div>
          </div>
        </div>

        {submitted ? (
          <div className="space-y-2">
            <p className="text-neon-green font-mono text-sm">
              Score submitted! {rank && `Rank #${rank}`}
            </p>
            <button
              onClick={() => navigate('/leaderboard')}
              className="btn-secondary text-sm w-full"
            >
              View Leaderboard
            </button>
          </div>
        ) : isAuthenticated ? (
          <div className="space-y-2">
            {error && <p className="text-neon-red text-xs">{error}</p>}
            <button
              onClick={handleSubmit}
              disabled={submitting}
              className="btn-primary w-full"
            >
              {submitting ? 'Submitting...' : 'Submit Score'}
            </button>
          </div>
        ) : (
          <div className="space-y-2">
            <p className="text-white/40 text-xs font-mono">Log in to submit your score</p>
            <button
              onClick={() => navigate('/login')}
              className="btn-secondary text-sm w-full"
            >
              Login
            </button>
          </div>
        )}

        <button
          onClick={() => game.startGame()}
          className="btn-primary w-full"
        >
          Play Again
        </button>
      </div>
    </div>
  );
}

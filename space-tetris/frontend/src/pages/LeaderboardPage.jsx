import { useState, useEffect } from 'react';
import { leaderboardApi } from '../services/api';
import { useAuthStore } from '../stores/authStore';

const PERIODS = [
  { key: 'alltime', label: 'All Time' },
  { key: 'weekly', label: 'This Week' },
  { key: 'daily', label: 'Today' },
];

export default function LeaderboardPage() {
  const [period, setPeriod] = useState('alltime');
  const [scores, setScores] = useState([]);
  const [loading, setLoading] = useState(true);
  const { user } = useAuthStore();

  useEffect(() => {
    let cancelled = false;
    setLoading(true);
    leaderboardApi.get(period)
      .then((data) => {
        if (!cancelled) setScores(data.scores || data || []);
      })
      .catch(() => {
        if (!cancelled) setScores([]);
      })
      .finally(() => {
        if (!cancelled) setLoading(false);
      });
    return () => { cancelled = true; };
  }, [period]);

  return (
    <div className="max-w-2xl mx-auto p-4 space-y-4">
      <h1 className="font-display text-2xl font-bold tracking-wider text-neon-cyan neon-text">
        Leaderboard
      </h1>

      <div className="flex gap-2">
        {PERIODS.map((p) => (
          <button
            key={p.key}
            onClick={() => setPeriod(p.key)}
            className={`px-4 py-2 rounded-lg text-sm font-mono transition-colors ${
              period === p.key
                ? 'bg-neon-cyan/20 text-neon-cyan border border-neon-cyan/40'
                : 'bg-space-700/40 text-white/50 border border-white/5 hover:text-white/80'
            }`}
          >
            {p.label}
          </button>
        ))}
      </div>

      <div className="glass-panel overflow-hidden">
        <table className="w-full text-sm font-mono">
          <thead>
            <tr className="text-white/40 text-xs uppercase border-b border-white/10">
              <th className="px-4 py-3 text-left">Rank</th>
              <th className="px-4 py-3 text-left">Player</th>
              <th className="px-4 py-3 text-right">Score</th>
              <th className="px-4 py-3 text-right">Level</th>
              <th className="px-4 py-3 text-right">Lines</th>
            </tr>
          </thead>
          <tbody>
            {loading ? (
              <tr><td colSpan={5} className="px-4 py-8 text-center text-white/30">Loading...</td></tr>
            ) : scores.length === 0 ? (
              <tr><td colSpan={5} className="px-4 py-8 text-center text-white/30">No scores yet. Be the first!</td></tr>
            ) : (
              scores.map((s, i) => (
                <tr
                  key={s.id || i}
                  className={`border-b border-white/5 ${
                    user && s.username === user.username ? 'bg-neon-cyan/5' : ''
                  }`}
                >
                  <td className="px-4 py-3 text-white/60">{i + 1}</td>
                  <td className="px-4 py-3 text-white">{s.username}</td>
                  <td className="px-4 py-3 text-right text-neon-yellow">{s.score?.toLocaleString()}</td>
                  <td className="px-4 py-3 text-right text-white/60">{s.level}</td>
                  <td className="px-4 py-3 text-right text-white/60">{s.lines_cleared}</td>
                </tr>
              ))
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
}
